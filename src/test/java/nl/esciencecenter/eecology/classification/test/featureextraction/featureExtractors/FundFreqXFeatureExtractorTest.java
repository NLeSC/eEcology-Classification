package nl.esciencecenter.eecology.classification.test.featureextraction.featureExtractors;

import static org.junit.Assert.assertTrue;

import java.io.IOException;

import nl.esciencecenter.eecology.classification.featureextraction.FormattedSegments;
import nl.esciencecenter.eecology.classification.featureextraction.featureextractors.FundFreqXFeatureExtractor;

import org.jblas.DoubleMatrix;
import org.junit.Before;
import org.junit.Test;

import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;

/**
 * @author Elena
 *
 */
public class FundFreqXFeatureExtractorTest extends FundFreqFeatureExtractorTest {

    /**
     * Takes some input (20 x 60 normally distributed) and compares it to its output (before a refactoring).
     */
    @Test
    public void extractFeature_someInput_correctOutput() throws JsonParseException, JsonMappingException, IOException {
        // Arrange
        String xSerialization = "[[-1.3685757610487272,0.4865581931412204,0.942096566070898,-0.6746404323087734,0.24234782198960783,-1.1094370268486806,1.7205202130782458,-0.3728406705853959,-1.1434060513677613,0.7344530370674635,-0.3241620651781086,-0.06395809838412583,0.06921409613676847,-0.2956347833590914,-0.8880236020678908,0.4329387991014069,0.9195537617091615,-1.8632399225745624,-0.687409069685978,-0.21433509395695743,-0.05575961730544344,1.2811717363152464,0.8082549155799198,-1.4075915890915494,1.906780225132224,-1.1904826791299443,2.5825005537222276,-0.9294836631062957,1.3505877287522576,0.7998715977812086,-2.0758719468986166,0.4145245806319625,0.3742488730788252,-0.7645870588980536,-0.6049444626431532,-2.2967564986537146,-0.473075961706905,-0.6867258459937715,1.763819448495461,0.5639227491198896,0.4408523149773589,-1.332738514971052,-1.5354230430154248,-0.40500891692419694,-0.1386793588431844,-0.6762858377093441,1.1324883303814712,0.6703407863726191,0.23128630555006902,-0.01017396282619391,0.8580306934953845,-2.640331707818682,-0.7578036084538065,-0.831283739290814,-0.776592428517274,-0.8403323918909247,0.42595225241672124,0.20304844308556647,-1.1420960744387982,0.3167745022497887],[1.5467402376220674,-0.5258622127394009,-0.35761606920568706,0.1733759921146124,-0.291009501246659,0.5720728614331959,1.5908564431453969,0.20239301631232137,-2.073226211488443,-1.4983758452032971,-0.02459060696508383,-1.1668689699373318,-2.283474228767485,-1.2141322087484443,0.47245300613045077,1.0084516435128497,-0.13680332711828105,1.2883573582039816,0.5053960022047044,0.025514930194723347,1.2313782293429907,-0.2788906626995461,-1.1020934454434412,-1.280836063397473,-0.6761472881884936,1.1761549051472862,1.0655048327894363,0.40525407788284906,-0.9673907399393389,0.8136519342676147,-0.8388177398002545,-0.1959096022679846,-0.14622257095675156,1.2562980310271794,-0.4292023065342223,-0.5932257905299938,0.08763575603529157,-1.785202640909017,-0.3757021222340913,0.7492224166389815,-2.0460221309499484,-0.30254675948993026,-0.35279917869452115,1.6332531175365046,-0.6708361252046937,-2.2576545419818657,0.5442524990431986,2.4760748647964035,1.686230175839108,-1.1300301335737133,0.6985154193633187,-1.0975940971998595,1.2907020097864652,-0.34396553070053065,1.2869988125230907,-0.47570403398850863,0.2743110662632234,-0.0869459522970941,-1.3710609034139227,0.10683308390307301],[0.44874036279050494,1.6064272854867931,-0.3842108054366791,-0.6881287694535517,0.08259384052643215,0.8870733788121807,-0.8491148015159443,-1.057297387115031,-0.5982520682173265,-0.8780282755136875,-0.2852127505927205,-1.3932192983782916,-0.05845599477681135,0.684490273904504,0.901181920249137,-0.5587689862237764,-0.7049347387924919,-0.7646638398317507,-0.021214898792632227,-0.5859729292984033,0.3238749998550669,1.134841706381724,1.7181172556779742,0.14214347126340576,0.2756029152532227,-1.0251635005710158,0.39604106025983915,0.11052212295430591,-0.21220115809427614,0.13942436651585646,0.8498256386644519,-0.6878995959218246,1.11001786534549,0.9301862548557904,-0.3658653927903497,0.31678713890457555,-2.021888675216626,0.9609511829188573,0.5620060660237537,-0.6992618695756448,0.21741560609749844,-0.32170147580147246,-0.45589380054831563,-1.0543520142019074,-1.5381025143743936,0.8888415329499424,0.32832174238871664,-0.8810532110502872,0.38778822148469266,0.2618711475913328,-0.17199513725069226,0.7555194627723492,2.0486809139324214,1.4570747541541351,-0.6847118586839919,0.47911421761523054,-0.6988047884967145,-0.3657707001202755,2.3027749446283945,0.007001600300660868],[0.6653018290060944,0.026595257498836063,-0.5559942592188835,-0.08833103961206627,1.2729012807900888,-1.8620974314369536,0.26849826216740164,-0.11874587125063762,0.5406721906813746,0.4144067903626501,0.6206697048600333,0.3358129968466933,-0.6787258591816128,-1.670375496538828,-1.605188028122896,0.369585449661318,-0.761054820343578,0.3683200209050998,-0.9885544272359161,-0.9080574174851904,-0.6665807902703007,-1.8542908591350757,-1.5724946811568858,1.1000475431173584,-0.597752245778285,1.0997901016155722,-0.8616717618109326,0.34862582366884987,2.5583679591285247,0.3610024654078356,0.21508289965841465,1.0856466575800587,0.3943127327674811,1.3625323661179283,1.812758810905281,-1.1098286282153256,1.0861040601863199,-0.2504848583204499,-0.15891872455353473,-0.32472777135176684,0.09302786395275545,1.8547786922440894,-1.2013820558999284,0.7323959702678499,2.015064619921681,1.340554793153719,-0.6462262831200706,0.5180157224109152,0.7454411848518325,1.6611369698773888,-2.332515901113932,-0.27276677865104165,1.1613967683999395,1.2269524467248722,1.1519090590038814,-0.833579738773633,-0.06542444250735033,0.7527853309628684,1.2257321823418488,-0.7650568900186258],[1.4578730433379379,-2.356377982225049,-0.442108610233538,-0.0860454157116915,0.15457740884329157,-1.9340732671425402,1.464911633399137,0.8487444475414495,-0.1399416371176376,0.2091445154726308,-1.9026265794167523,-0.021529968107973054,-0.5675012095293751,-1.1547569939338067,0.5508408889966481,-0.10094790755260859,-1.5792212081511927,0.49273454213378765,0.5070907887989893,0.5378816128209899,-1.830392274159331,0.45728780514478107,-0.8180395150434164,-0.18502876163156126,1.3991814826996336,0.21756768945987115,0.635806436528485,0.6220280505471995,-2.262811940219501,0.40396234076981247,1.32126694421589,0.43483891939427666,-0.44735834071419206,0.36566088074301745,2.1318087431405117,-0.8313551929846001,0.4293688426692982,0.0627877898024941,0.4610324445138416,1.1369987771267909,1.954734241334938,0.06333144303146124,-0.9841365161350533,-0.16304366793539318,-0.6047485179563168,-0.9659156333986828,0.7272484421156724,0.9955235796166452,-0.3382332413196677,-2.915956041768076,-1.8746629048412298,-0.3719475888313071,0.7625685473161429,0.05013792056905475,0.6140526767507584,-0.8438170999415882,-0.28815800788585644,0.9310648343717695,-1.407452363188243,-0.5336069810560198],[0.47529155639719606,-1.0470842075261437,-1.1285207030418545,-1.4546380833901078,-1.6748194858225156,0.40304872010053794,0.11523144913230063,-0.2612192502050977,-0.43693299713455785,-0.9901860358523117,-0.7775225308322378,-0.05799540402528163,0.876809245730358,-1.731905378339688,0.6035754849189653,-0.5887961738116074,-0.2773616772534149,-1.2765641566215373,-0.2783194881297564,0.33107693879016303,-0.6330704648005915,-0.162319172510534,0.48967291285209946,-0.7010006312818943,-1.7399883441060608,-1.4181478562145506,-2.2879633276472053,1.4789659193856737,-1.2585495537768558,0.26865096665784177,-0.09728196536559,-1.7682845167850127,-0.3975401129084832,-0.7203859375714281,1.2466906727552411,-0.8713973246197567,-0.27571972463103284,2.3261274017475495,-0.32473341870842376,0.348244091624432,0.2482507030330619,-1.895151328094983,0.48624147835255366,-1.8337787328477055,-0.3728625918918262,0.7723912305938068,-0.5099144965755437,-1.457841676680947,-1.556491183077818,-0.8132820497692922,-1.4712468619770083,-0.0011528093157439478,-1.3583628251060342,-0.10707068434159267,-0.7189691449023596,0.004140770259873858,2.6069227367266716,0.8869628306697386,-0.06774158492474336,-0.6954893732968015],[-0.2833274059126441,1.477325444227123,-0.8928598895361154,0.8328452802688696,-0.8221063094731925,0.4994674432970927,0.1948583478096783,0.48149457279722274,0.5382333232838741,0.051323666607890193,0.2766242484454702,0.8005118996799212,1.0273283401097055,-0.46479001412706533,-2.105815531598442,0.027200896735784425,-0.33111179276552705,3.088754536349343,0.4214105998729209,-0.954924063540815,0.17962407884759507,-0.26399852296519555,-2.0739647033428725,0.06118832001312096,-0.09358049175695679,0.3421856913321631,-0.8262414466380701,-1.3965390233136752,-0.1380412691724362,0.40812827532410834,-0.483728486267421,0.9935151516775519,1.0269056667768295,0.41673518518460106,0.6548920660789347,0.7192438835791536,0.802476424900247,-0.14032450987040565,0.09163797875938849,0.5408812979459623,0.9235547811084012,-0.6892370898234499,0.8857668572605462,-0.29223411421735557,-0.36783847391891,-0.1797100401355603,1.0294963477731491,0.2664108354609584,0.5527950515491192,0.6745789032308325,0.9334137066377304,-1.3720889859295182,1.2249732268356373,-1.3820749378849062,-1.4889803258158216,-0.28815890468905986,1.0022852985984585,-0.44149131138245673,0.4183988864317648,0.5630411904765044],[1.0516003862645098,-0.473741461515051,0.5790415286043207,-1.2102444804189296,1.1707041267928675,0.13376660480576671,-0.1733783920019147,-2.7988844405902302,-1.2771903532765307,-0.6993438171377768,-0.25514309041551636,-0.8918246354496514,0.115212122617512,0.0703945359703543,-0.5326628774189965,-0.620173060650131,-0.5080082849756484,-0.3810057128628483,0.20283062898271764,-0.0013415621276243585,-1.382717780864738,-1.1689742803892615,-2.02462670986367,-2.0001193911016353,1.3845472723080328,1.4074424111455266,-1.4184195372915482,0.25046526464038676,-0.376125275101189,-0.17741797547196944,-0.47734075674022713,-1.6072607699565997,-0.31125124896529494,0.9201803718358722,-1.6731384338711963,-2.1275473183664877,-0.8746161425954712,0.8519975195212046,1.5611755208039173,-0.24477808789710437,1.2510336066150638,1.2294428154619965,0.9260801752469281,-1.6223966584865892,0.3242138024492056,1.4436470930647722,-0.704693254276396,-1.0561548559846028,-0.969124867032802,-1.2739015324596814,-0.11014763694705271,0.8583258246414219,1.6381604848967113,0.0032871382351330435,1.8067617769114834,-0.45991586264989315,-0.7993822643418242,0.6148214037452725,-0.5472320634409822,-0.5556106123381763],[1.2468655744174473,0.9848013884405872,1.2800957540862066,-1.3106907006962372,0.8249378737954609,-0.5755145981758948,0.37351696645168947,-0.005165889700282729,-0.6291603939901746,-0.8203533726461439,-1.2194904362555352,0.08644815996574522,0.3685176369947892,-1.6006701356621589,-1.3306464336759631,0.047540734224281,0.6445473396349375,0.10922002583514927,-1.6485613553993543,-0.24530556045038862,-0.0028061909777410254,1.6667188314528716,1.0112325781127642,0.902798848763722,0.5558309986287253,-0.7045833588182284,0.7647190358712644,-0.3619196269653317,-0.8948745502477018,1.0957000758315938,0.583314552760622,-0.10106050110646053,0.5359957770023815,0.38669386500611747,-0.22916228309954273,0.5000948448288751,0.1214015773773868,0.3054079037411884,0.9479571679203578,0.9925073369090764,0.9489329912485887,0.14292900155554072,0.4546138746052763,-0.16568765689190296,1.0436132505017133,-0.27353224692226974,0.8237441675034365,-0.24455041910045902,-0.15846944550242753,-1.4288114840692054,-0.6357211890885648,-0.08989240977579532,-2.155667488205748,-0.3674117330290914,0.14380620985688528,-0.536816537910825,-1.5197861151214969,1.238987861944062,0.3811107723154657,1.963357626271903],[-0.21904666941969292,-0.4835809548667508,0.8126369487959384,-0.19471794737457232,1.954445856422715,0.23317118675545553,1.3654204425340433,0.039022613840694574,-0.11906521060393888,-0.42902078328093746,0.5102136640269825,0.8350399459862115,0.6391124887008475,-0.21790108255142585,-0.2370664249529476,1.2484232305301826,-1.1298478075406557,1.2483502066341503,0.7273585078501393,-0.66691103571006,0.6064332338736663,2.8398388599347704,-0.4247079225211199,-1.221298728543343,0.21453045482732921,-1.5058420704054323,-1.709564496682941,-0.7246431596120063,-0.06224104708660194,0.17828779874988737,-1.3479606970996207,-0.04477231691001538,0.8952501398014948,0.14823322363162628,-1.1717626111916548,1.6632925297696393,0.5180782968112201,-0.121285804773075,-0.06260439347125674,-0.2611873444738655,0.5069756490459831,-1.0849726139912426,-0.3714287460361596,0.4599049782312332,0.9467840427740075,-1.0605036197687645,1.381352215044072,-0.5020905063651074,0.2957261206462749,-1.0038191292209229,-1.4181213368717336,0.0039706483240936515,-0.6294715704938418,1.401955337853187,-0.4771158737167238,-1.6800028654116124,-0.14764787579670333,0.0014571796097944823,-0.30713978234364864,0.17602593672333655],[0.7235243552805812,1.2256408316536607,-0.714411101722698,-0.4112312870467514,1.6689086113336482,0.819235914452911,-1.702869948742789,-0.752367642253666,-0.29236126997279205,0.2205905426954106,-0.11999399954485648,-1.0143914765011632,0.5259054560375775,1.7825965901969403,-1.227737063999724,0.6761191517311261,0.611162651519206,-0.48579527804088257,-0.219554378726012,-0.3756328462908904,-0.08949754426393529,0.13302980298225045,0.5089821102583817,-0.6571034528740285,-1.6314138649655363,1.5855541376460918,-1.4024535137426808,-0.914164077408431,-0.942901872179925,0.44239528554694896,-1.0435227510748861,0.43534616390724507,0.3184365010577679,0.15711670444478412,1.1205834801584735,1.215549782084137,-1.4523259257425216,0.13575705665939036,-0.28685120972200623,0.8483844779348979,-0.11227730677733526,-0.41283462722301584,1.4521232019784602,0.8717064019370308,-0.28728330724453444,0.5884803926930917,-1.6931294470790743,-0.5938462499314653,-1.35411407955553,-0.09255588525947167,0.46452476524060354,0.06731358227623793,0.6324089730259745,-0.37671513127535494,0.11705066476271261,1.1448293990086855,0.7091658558936227,-0.5372644847490137,0.394272024441816,0.5601244505297424],[-2.5340692678620513,0.019614835524641917,1.6819562798365562,-2.723007033407246,-0.3305812932658781,-1.6424681130572012,-0.02412165879270869,0.7867320598013126,1.7511861219921276,-0.3604366268821342,2.023207130806117,-0.98629548428703,-0.32725738519721725,-1.3171957286559395,2.005191088315703,-0.7262187897792497,0.9944417303052954,-0.8797952348795735,1.2257285996686325,0.6787237576188921,0.9489111097499972,0.2291812897210031,1.1517422729499045,-0.7441390511819608,-0.3182520679383285,0.0700722006150466,-0.21056482082400768,-1.221677216584291,0.21332627924144804,0.9482540824830478,0.11595376482861267,-0.4339272506661048,0.37700302342184555,0.4711595250220952,0.1963238725735105,-0.3107283819102139,-0.22994434963641755,1.3004031593013676,-0.04744343371217055,-2.0859319621637358,0.31605255397053617,0.1368228976181274,-1.2073592675110882,1.2228052552072555,0.8992927211208281,0.6987634571859522,-0.29624041793800815,1.0675557701281284,-0.07261153624531042,-0.1922152266403297,-1.200328979032694,0.1675494590216824,0.5822232700969271,0.5959050914231816,0.061462414643026195,1.2657176565060309,0.04333369676549897,-0.05403461458113646,1.8232885011643518,-0.40329526884938327],[0.09386936609290981,-0.48512744022680815,0.6248173648760085,0.36782217317884314,0.2685399045481087,0.007804572663841244,-0.026363151343802994,0.6692063405745624,0.9200685151127824,1.5834600033769028,-1.4499085858733094,-0.44851190187795237,-0.8313118465201049,-0.1509251236243452,0.20622964805421498,-2.1332350638444777,-1.1759739938561262,-0.7553876953924655,-0.7958268347409057,0.7638922070100834,-1.254095884765565,-0.4143209928013144,-1.1265027700012482,1.2068483119370383,-0.4117042732592876,0.9185135162898188,-1.4972934410278118,0.9771271609079824,0.5884660562192366,-1.3619767385168828,-1.739078252940708,0.690439666841982,-0.1559615695181867,-1.1763136539868333,0.4924341813562231,-0.5094775434824854,-0.11882875084885827,-1.6534486241410287,-1.1415010355941442,-1.5208206337995565,0.4477244436478239,-0.05749125876020074,2.490835171476692,-1.0218703971459924,-0.683221390585503,0.9392227930192343,2.0397697862256394,1.1799037864633848,1.0321345870818919,-0.48790573861092135,0.31359380805764403,0.04868625405084838,0.5514497578722253,-1.5963255311563758,1.4208953363714696,0.38330908990829904,-1.3418317976415555,-1.8993799796970994,0.5304770870604265,-0.5351024641057027],[-1.4866695086890769,0.6665375541660638,-1.7231843975820784,-1.2108948197008857,0.8384767604816062,-0.4825515573463214,0.6067574538291532,-1.563904767610573,0.9680446537104476,1.3218842520701557,2.6587859580903266,-0.3775070185051944,-0.5697130272880706,-0.17678501932303498,0.5091566983038458,0.06771045079976354,0.34229402766525824,-1.3928350481165714,0.31871014592614966,0.3442315736680642,1.8881313107304474,-0.9947245703667584,1.2256663313196754,1.638893452441726,0.5361387246303927,-0.2161593927978467,1.0465899286888733,0.5664341400637996,-1.0099862551246048,-0.3509090388960674,-0.8459568829107388,-0.8689087852778479,0.0035045854028681774,0.73346959459469,1.0563456969950735,-1.2488096535602409,-1.0705201821546684,-0.3641960292300761,-0.3008150056069072,0.3612199542255492,-1.249075720387017,1.2142236104051063,-1.300932201316401,0.5707675066138909,-0.5505776749095882,-0.39946475416523164,-1.3662223861495735,-0.5068511235303418,-0.5224863682924541,-1.49401269074122,-2.1592747356516417,1.4282342188415065,-0.9904793991783316,-0.8589546794152741,0.5166028479257821,-0.46587749517541244,2.094439036709434,0.43924728752072834,-1.0566844090420182,0.26209502612517643],[2.295219010279764,0.3805822744823357,-0.0655180375819004,-1.4652215959692654,-0.7214520210559606,-0.6010095175104422,0.9792564985163437,0.3964590664597843,-0.14620706569905406,-0.5342649116821899,-1.83705837857626,-0.2871924857200596,-2.244247069166241,0.32405761798607163,-0.21731978653804446,0.2654493571919928,1.0510665068743463,-0.6282662858415573,1.5974839475910512,0.045863558955960664,-1.6307754941177324,-1.0818850121864159,-0.023978774505368106,0.8145732695068895,-0.7773391441615343,0.42461057859286366,-1.6758326636393015,-0.6917422212034592,0.8498711671437023,0.5267780856538888,0.5870390235709115,-1.0027458833917129,2.173598002622483,-0.6120960294480263,0.14756234862934758,1.0806427521361432,-0.49088631326426574,0.9933946284253014,-0.1773087867028294,-1.542327693162879,-1.4610264587474757,0.36502824730054617,-0.0054977246988871286,0.5564936330883983,0.25965174160976096,0.16857635714439223,0.2535211872320384,0.7470610646022435,-1.5042890233848167,-0.5430363560368894,0.07244619145084312,0.48546276634219004,-0.5402238222775244,0.9458824998530088,0.31601728839142135,-0.47993019271632087,0.056667281107876534,0.6158799938445016,-0.7353326943655951,-1.3420107809805235],[0.256768230057535,-0.01744254116911656,0.597208510279474,0.9031398265733644,-0.48734619569137394,0.013579317758961101,-0.17153551614041476,-0.7907495130009317,-0.07759243341406512,2.29106028523689,0.6399295859098996,-1.1058172171599074,1.7252002129380406,-1.4681246127187992,-1.6396644199876198,1.556635677271235,0.49986507374125466,-0.3174427494460497,-0.3587006645578675,0.4374769848297624,0.20474486983051216,0.28612526866875676,0.6074340145839726,0.6175313845541991,-0.46685711407104363,0.24738155740663478,0.294116311963474,-0.46556489634210024,-1.6503788228134397,1.7557065678630688,0.08850253258372162,0.13826457690126168,-1.0781429271341878,1.8475347216880817,-0.9599139256975666,1.530974427894324,-0.8934034950382977,-1.4369995520250525,-0.3314255499025298,0.37067102975621574,-0.2655633671965246,0.6427558509247613,0.910390291633914,-1.2383037219404627,1.2428370889261076,0.4680100054510406,2.6646340980665792,0.7454146453035552,1.0177166043146495,-0.07139548045907322,-1.3310192961680347,1.0662714688363601,-0.9090839572244503,-0.022047698145389507,1.723549299522592,-0.49144204823915616,0.985783881602765,0.0882768352813198,-1.1049028279483966,1.7747475744510743],[-0.08302164409159261,0.8328191001558676,0.07066159129334303,0.3825126987489545,1.7051729192464526,1.5530937713044974,-1.7801477984491298,-1.3774155849393834,-1.6656704031261997,-0.8331244972686185,0.6290472526876572,-0.31100541525053943,1.607198537779467,0.30930927036627415,-0.8401661994719883,1.3966841226262119,-0.219793775030826,0.6891370344203203,-0.7021613107271246,-0.8210457621049526,0.2733941334813717,-0.6593858980553794,-0.5490573169616728,-0.7586353402898741,-0.07333885606911521,1.3259112566458378,-1.0725893553056236,0.12429717034444017,-0.12360086777389855,0.01935654834559947,0.2650771834785596,-1.4823714224625546,-0.26958996694181175,-1.116297181888882,0.05609741510508205,2.2856357133156764,0.7176376563177773,-1.5646084998685992,0.20628122377649644,1.4429663192772266,-0.3056682213905433,-0.14060283621708478,-0.029221676771049757,-0.5540883814319603,-0.8418367027227446,-0.8792129507344371,-2.0654822268852384,-0.3561664141611058,-1.4263408244672922,-1.1609158637548906,-0.8706007206636099,-0.14677137888362426,1.3568189093575724,1.3870195178252287,-0.05446188812135827,0.2961977007464578,-0.23682260757343232,0.9986986606966486,-0.16462125549168627,-0.9265625133714382],[0.9865114962197735,0.0910788670366471,0.581415267669556,-0.8188514310620739,-0.3113696254816015,0.542649205193313,-0.570892112257863,0.4579355942886021,-1.2984149908670657,-1.169359455697737,0.20034187743412818,1.6353249960460683,-0.6618610739810841,-0.020694338757788956,0.41608874320143646,0.7773774280930849,-0.30408211006885977,-0.9254489882145804,1.8542451658477288,-2.0854555218850024,1.620254475434027,-0.30150429700444864,0.20932556935302712,-1.141204432690591,-0.5934652812007232,1.048745144367393,-0.16100881918083143,-1.1038948876294272,-0.22679268416210852,-0.8310773347645609,-1.1011447028140242,-0.00971232777747527,-0.3693985763795998,-1.1384432292957876,0.7573715144239589,-0.5926550632611818,0.1487706599737099,0.13679835055502426,-2.285636187786234,-0.17665794861003908,0.7695503465758673,0.05084917806602199,-0.9517561645550485,-0.03697582035803634,0.4773831147414547,-0.05797157158992045,-0.09291346184734535,-1.420931006002943,-0.04404932470404374,0.5791452558046304,1.1576860420116903,0.3888226646704976,0.4302590146602667,1.901243284911516,-0.18682433560510037,0.30550050654887945,-0.4639374645136046,-1.4970575725620812,1.4893640295340675,-0.6243339778567586],[-2.527810035748506,-0.5497044232305337,0.2587778000829482,1.9545865317387783,0.6506925711151291,-0.132639343057485,-1.404610787449262,2.046277850266684,-0.30946786276634863,0.7258299640025336,-1.122068880647473,0.848182176030601,-0.2146775541498727,-0.5265735611204317,0.21762293153039086,0.9800222343218258,0.5749541278066095,-0.5068412831710826,2.266232384708858,0.7661820406405572,0.7913513955787126,-0.3551575992130693,-0.9610120483048429,-0.46994186134318666,-0.20127489988192188,-1.0574053589559274,-1.9022904282086983,2.3834153240313007,-0.6417293565490166,-0.593489098150462,-0.6364651616157307,0.2748766601143476,1.5061309574956572,1.5109134213594397,0.8764661932500453,-0.8121685810125907,-0.4346431574921329,-1.2166716004837739,-0.22428054970556402,-0.31576723567446974,-0.1795674939587358,-1.4297429089494815,-0.3496766225817764,0.5436546017735667,-0.4334994442435132,-1.188630585106245,-0.9343118573542203,0.8635553692457557,0.9835899102901912,0.9702593941466918,-0.8324135655599019,-0.8302346594355061,0.9345632040727461,1.7500544339561683,-0.1397008559655717,0.9393210793751262,0.026381555111816078,0.6158428683793324,-1.1193513520515135,-0.08400555910685137],[-1.131615709475385,0.6235479141539544,-0.08672281889290277,0.4411739750534553,-0.34924578287745295,0.6500715905215486,-1.5453790339458875,-0.6487902564863666,-0.05668502654974911,0.28915195261598714,1.5328210277600973,0.33488370559566527,-1.2775721615948354,1.5401174049305404,0.6691440227357697,0.5162672993908783,0.019083094874471993,0.44300971193416616,0.6430268721970306,-0.22397768917114932,1.5115150049871493,0.28787759008838065,1.4413266890434726,0.1276357425279671,-0.5833262002310925,0.07726617713548414,0.5905493254192979,1.6168387963517874,-0.6001299081183491,1.4739808006272748,-0.1828974035401232,-0.16970099107450298,0.2831605723499606,-0.5238117570647117,0.542022234812115,0.02073168599967965,1.338223691939741,1.5008519881113234,-0.2504982454596339,0.19677896843771506,-1.3060275408046984,0.5917152418584415,1.0387844788101281,0.8922675883762587,-0.2550070330437966,-0.8531498054489829,0.47900990949441974,0.3631090391218613,1.007308133111449,-1.2505871979687528,1.9039465616141933,-0.36474417275693577,-0.29555688864031227,0.42136695147686304,0.03068180986223083,0.1397762183836017,1.2832037106833387,0.9961193415230116,0.7696553877710732,1.6921205982499443]]";
        String expectationSerialization = "[[8.0],[4.333333333333333],[5.0],[7.666666666666667],[6.333333333333333],[8.0],[2.6666666666666665],[5.0],[1.0],[5.333333333333333],[4.666666666666667],[5.333333333333333],[9.666666666666666],[5.666666666666667],[8.333333333333334],[9.333333333333334],[8.0],[8.666666666666666],[1.3333333333333333],[8.666666666666666]]";
        DoubleMatrix x = new DoubleMatrix(deserialize(xSerialization));
        DoubleMatrix expected = new DoubleMatrix(deserialize(expectationSerialization));
        FormattedSegments formattedSegments = createFormattedSegments(x, x, x, new DoubleMatrix());

        // Act
        DoubleMatrix result = featureExtractor.extractFeatures(formattedSegments);

        // Assert
        assertTrue(result.equals(expected));
    }

    @Before
    public void setUp() {
        FundFreqXFeatureExtractor fundFreqXFeatureExtractor = new FundFreqXFeatureExtractor();
        fundFreqXFeatureExtractor.setFundFreqExtractor(getFundFreqExtractor());
        featureExtractor = fundFreqXFeatureExtractor;
    }

    private double[][] deserialize(String str) throws IOException, JsonParseException, JsonMappingException {
        ObjectMapper mapper = new ObjectMapper();
        double[][] doubleMatrix = mapper.readValue(str, double[][].class);
        return doubleMatrix;
    }

    private void printSerialization(DoubleMatrix x) throws JsonProcessingException, IOException, JsonParseException,
    JsonMappingException {
        ObjectMapper mapper = new ObjectMapper();
        String xStr = mapper.writeValueAsString(x.toArray2());
        System.out.println(xStr);
    }

}
